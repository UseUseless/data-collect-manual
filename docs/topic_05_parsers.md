# –¢–µ–º–∞ 5: –ü–∞—Ä—Å–µ—Ä—ã HTML: BeautifulSoup vs lxml vs Selectolax. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —É–¥–æ–±–Ω–∞—è BS4, –∞ –∫–æ–≥–¥–∞ —Å–∫–æ—Ä–æ—Å—Ç—å lxml?

–ò—Ç–∞–∫, —Ç—ã —Å–∫–∞—á–∞–ª HTML. –¢–µ–ø–µ—Ä—å —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –¥–ª–∏–Ω–Ω–∞—è, —Ç—É–ø–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ 500 –∫–∏–ª–æ–±–∞–π—Ç.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ –≤ —ç—Ç–æ–π –∫—É—á–µ –º—É—Å–æ—Ä–∞ –æ–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π –±—Ä–∏–ª–ª–∏–∞–Ω—Ç (—Ü–µ–Ω—É).
–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω –ø–∞—Ä—Å–µ—Ä ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ –¥–µ—Ä–µ–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ (DOM), –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å.

–í—ã–±–æ—Ä –ø–∞—Ä—Å–µ—Ä–∞ ‚Äî —ç—Ç–æ –≤—ã–±–æ—Ä –º–µ–∂–¥—É **–∫–æ–º—Ñ–æ—Ä—Ç–æ–º** –∏ **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é**.

---

### 1. BeautifulSoup4 (BS4) ‚Äî "–£—é—Ç–Ω—ã–π –¥–∏–≤–∞–Ω"

–≠—Ç–æ —Å–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞. –ù–∞ –Ω–µ–π –ø–∏—à—É—Ç 99% —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤.

- **–°—É—Ç—å:** –≠—Ç–æ –Ω–µ —Å–∞–º –ø–∞—Ä—Å–µ—Ä, —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∞. –û–Ω–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–∏–π `html.parser` –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–π `lxml`.
- **–ü–ª—é—Å—ã:**
    - **–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —É–¥–æ–±–Ω–∞—è:** `soup.find('div').text`. –ß–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫.
    - **–í—Å–µ—è–¥–Ω–∞—è:** –ñ—Ä–µ—Ç –ª—é–±–æ–π –∫—Ä–∏–≤–æ–π, –ø–æ–ª–æ–º–∞–Ω–Ω—ã–π, –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–π HTML. –û–Ω–∞ —Å–∞–º–∞ –¥–æ–¥—É–º–∞–µ—Ç, –≥–¥–µ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ–≥.
- **–ú–∏–Ω—É—Å—ã:**
    - **–ú–µ–¥–ª–µ–Ω–Ω–∞—è:** –°–æ–∑–¥–∞–µ—Ç –∫—É—á—É –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –ñ—Ä–µ—Ç –ø–∞–º—è—Ç—å. –ù–∞ –æ–±—ä–µ–º–∞—Ö 100–∫+ —Å—Ç—Ä–∞–Ω–∏—Ü —Ç—ã –ø–æ—Å—Ç–∞—Ä–µ–µ—à—å, –ø–æ–∫–∞ –æ–Ω–∞ –∑–∞–∫–æ–Ω—á–∏—Ç.
- **–í–µ—Ä–¥–∏–∫—Ç:** –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤, –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤ –∏ –∑–∞–¥–∞—á "—Å–ø–∞—Ä—Å–∏—Ç—å 100 —Å—Ç–∞—Ç–µ–π".

### 2. lxml ‚Äî "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–æ–∫"

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏. –ù–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ C (libxml2).

- **–°—É—Ç—å:** –ñ–µ—Å—Ç–∫–∞—è, –±—ã—Å—Ç—Ä–∞—è, –º–æ—â–Ω–∞—è.
- **–ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **XPath**. –≠—Ç–æ —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ XML/HTML, –∫–æ—Ç–æ—Ä—ã–π –≤ 10 —Ä–∞–∑ –º–æ—â–Ω–µ–µ CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤. –¢—ã –º–æ–∂–µ—à—å —Å–∫–∞–∑–∞—Ç—å: *"–î–∞–π –º–Ω–µ —Å—Å—ã–ª–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –≤—Ç–æ—Ä–æ–≥–æ –¥–∏–≤–∞, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å —Å–æ—Å–µ–¥ —Å —Ç–µ–∫—Å—Ç–æ–º '–¶–µ–Ω–∞'"*. CSS —Ç–∞–∫ –Ω–µ —É–º–µ–µ—Ç.
- **–ü–ª—é—Å—ã:** –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è.
- **–ú–∏–Ω—É—Å—ã:** API —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ (–¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ).
- **–í–µ—Ä–¥–∏–∫—Ç:** –í—ã–±–æ—Ä –ø—Ä–æ—Ñ–∏. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑ –ø–æ –¥–µ—Ä–µ–≤—É) ‚Äî —Ç–æ–ª—å–∫–æ `lxml` + XPath.

### 3. Selectolax ‚Äî "–ë–æ–ª–∏–¥ –§–æ—Ä–º—É–ª—ã-1"

–≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–≤–µ—Ä—å. –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ –¥–≤–∏–∂–∫–æ–º Modest (–Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ C, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π).

- **–°—É—Ç—å:** –°–∫–æ—Ä–æ—Å—Ç—å –ª—é–±–æ–π —Ü–µ–Ω–æ–π.
- **–ü–ª—é—Å—ã:**
    - **–ë–µ–∑—É–º–Ω–æ –±—ã—Å—Ç—Ä–∞—è:** –í 10-20 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ BeautifulSoup. –û–Ω–∞ –ø–æ—á—Ç–∏ –Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä.
    - **–õ–µ–≥–∫–∞—è:** –ú–∏–Ω–∏–º—É–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è RAM.
- **–ú–∏–Ω—É—Å—ã:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã. –ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–µ–Ω —Å–ª–æ–∂–Ω—ã–π XPath ‚Äî —É–≤—ã. –ß—É—Ç—å –º–µ–Ω–µ–µ —É–¥–æ–±–Ω—ã–π API.
- **–í–µ—Ä–¥–∏–∫—Ç:** –ï—Å–ª–∏ —Ç—ã –ø–∞—Ä—Å–∏—à—å –º–∏–ª–ª–∏–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Å—Ç–∞—è ‚Äî —ç—Ç–æ –±–µ–∑–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä.

---

### ‚öîÔ∏è –¢–ï–°–¢ –ù–ê –°–ö–û–†–û–°–¢–¨ (Benchmark)

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –º—ã –ø–∞—Ä—Å–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É Amazon (200 –ö–ë HTML).

| –ü–∞—Ä—Å–µ—Ä | –í—Ä–µ–º—è –Ω–∞ 1 —Å—Ç—Ä. | –ù–∞–≥—Ä—É–∑–∫–∞ CPU |
| --- | --- | --- |
| **BeautifulSoup** | ~20.0 –º—Å | üî• –í—ã—Å–æ–∫–∞—è |
| **lxml** | ~4.0 –º—Å | üü° –°—Ä–µ–¥–Ω—è—è |
| **Selectolax** | **~0.8 –º—Å** | üü¢ –ü–æ—á—Ç–∏ –Ω–æ–ª—å |

*–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É 20–º—Å –∏ 0.8–º—Å –∫–∞–∂–µ—Ç—Å—è —Å–º–µ—à–Ω–æ–π? –£–º–Ω–æ–∂—å –Ω–∞ 1 000 000 —Å—Ç—Ä–∞–Ω–∏—Ü.*

- BS4: **5.5 —á–∞—Å–æ–≤** —á–∏—Å—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞.
- Selectolax: **13 –º–∏–Ω—É—Ç**.

---

### üë®‚Äçüíª –ö–û–î: –ü–æ—á—É–≤—Å—Ç–≤—É–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

–ó–∞–¥–∞—á–∞: –î–æ—Å—Ç–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `<h1>` —Å –∫–ª–∞—Å—Å–æ–º `title`.

### BeautifulSoup (–£–¥–æ–±–Ω–æ)

```python
from bs4 import BeautifulSoup
soup = BeautifulSoup(html, "lxml")

# –ú–µ—Ç–æ–¥—ã pythonic-style
title = soup.find("h1", class_="title").text

```

### lxml (–ú–æ—â–Ω–æ - XPath)

```python
from lxml import html
tree = html.fromstring(html_content)

# XPath - –º–æ—â—å. "//" - –∏—Å–∫–∞—Ç—å –≤–µ–∑–¥–µ, "@class" - –∞—Ç—Ä–∏–±—É—Ç
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï–ì–î–ê —Å–ø–∏—Å–æ–∫
title = tree.xpath('//h1[@class="title"]/text()')[0]

```

### Selectolax (–ë—ã—Å—Ç—Ä–æ)

```python
from selectolax.parser import HTMLParser
tree = HTMLParser(html_content)

# CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã only. –°–∏–Ω—Ç–∞–∫—Å–∏—Å —á—É—Ç—å —Å—Ç—Ä–æ–∂–µ.
node = tree.css_first("h1.title")
title = node.text() if node else None

```

### üß† –í—ã–≤–æ–¥ –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞:

1. **–ù–∞—á–∏–Ω–∞–π —Å BeautifulSoup.** –°–µ—Ä—å–µ–∑–Ω–æ. –ù–µ –≤—ã–ø–µ–Ω–¥—Ä–∏–≤–∞–π—Å—è. –ü–æ–∫–∞ —Ç—ã –ø–∏—à–µ—à—å –ª–æ–≥–∏–∫—É –∏ –æ—Ç–ª–∞–∂–∏–≤–∞–µ—à—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã ‚Äî —É–¥–æ–±—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏.
2. **–£–ø–µ—Ä—Å—è –≤ —Å–∫–æ—Ä–æ—Å—Ç—å?** –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Å—è –Ω–∞ `Selectolax`. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∑–∞–π–º–µ—Ç 10 –º–∏–Ω—É—Ç, –∞ –ø—Ä–∏—Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏—à—å –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω—ã–π.
3. **–°–ª–æ–∂–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞?** –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Ö—Ä–µ–Ω –Ω–∞–π–¥–µ—à—å (–Ω–µ—Ç –∫–ª–∞—Å—Å–æ–≤, —Ç–æ–ª—å–∫–æ "—Ç—Ä–µ—Ç–∏–π `div` –ø–æ—Å–ª–µ –ø—è—Ç–æ–≥–æ `span`") ‚Äî –±–µ—Ä–∏ `lxml` –∏ –ø–∏—à–∏ **XPath**. –≠—Ç–æ —Å–ø–∞—Å–µ—Ç —Ç–≤–æ–∏ –Ω–µ—Ä–≤—ã.