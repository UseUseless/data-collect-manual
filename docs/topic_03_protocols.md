# –¢–µ–º–∞ 3: –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã: HTTP/1.1 vs HTTP/2 vs WebSockets. –ü–æ—á–µ–º—É —Å–∞–π—Ç –º–æ–∂–µ—Ç –±–∞–Ω–∏—Ç—å –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞?

–¢—ã –º–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ–¥, –ø–æ–¥–æ–±—Ä–∞—Ç—å User-Agent –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ê–π—Ñ–æ–Ω–∞, –Ω–æ —Å–µ—Ä–≤–µ—Ä –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ—à–ª–µ—Ç —Ç–µ–±—è –Ω–∞—Ö–µ—Ä (403 Forbidden). –ü–æ—á–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã —Å—Ç—É—á–∏—à—å—Å—è –≤ –¥–≤–µ—Ä—å –∫–∞–∫ –¥–∏–Ω–æ–∑–∞–≤—Ä.

–ü—Ä–æ—Ç–æ–∫–æ–ª ‚Äî —ç—Ç–æ —è–∑—ã–∫ –æ–±—â–µ–Ω–∏—è. –ï—Å–ª–∏ —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å –Ω–∞ —Å—Ç–∞—Ä–æ—Å–ª–∞–≤—è–Ω—Å–∫–æ–º (HTTP/1.1) —Å —Ö–∏–ø—Å—Ç–µ—Ä–∞–º–∏ (Cloudflare), –æ–Ω–∏ —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞—é—Ç: "–î–µ–¥, –ø–µ–π —Ç–∞–±–ª–µ—Ç–∫–∏, —Ç—ã –±–æ—Ç –Ω–∞ –ø–∏—Ç–æ–Ω–µ".

---

### 1. HTTP/1.1 ‚Äî "–î–µ–¥–æ–≤—Å–∫–∏–π –º–µ—Ç–æ–¥"

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç 1999 –≥–æ–¥–∞.

- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç. –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å ‚Äî –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–≥—Ä—É–±–æ –≥–æ–≤–æ—Ä—è). –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—á–µ—Ä–µ–¥—å.
- **–ö—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `requests`. –î–∞, **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `requests` –Ω–µ —É–º–µ–µ—Ç –≤ HTTP/2**. –í–æ–æ–±—â–µ.
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã (Chrome, Safari) **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTTP/2 –∏–ª–∏ HTTP/3, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç.
- **–î–µ—Ç–µ–∫—Ç:** –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–∏–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç "Chrome 120", –Ω–æ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É HTTP/1.1 ‚Äî —ç—Ç–æ **–∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥**. –≠—Ç–æ 99% –±–æ—Ç.
- *–ö–æ–≥–¥–∞ —é–∑–∞—Ç—å:* –ù–∞ —Å—Ç–∞—Ä—ã—Ö, –¥—ã—Ä—è–≤—ã—Ö —Å–∞–π—Ç–∞—Ö, –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—Ä—Ç–∞–ª–∞—Ö, –≥–¥–µ –∞–¥–º–∏–Ω—ã —Å–∞–º–∏ –∂–∏–≤—É—Ç –≤ 90-—Ö.

### 2. HTTP/2 ‚Äî "–°–∫–æ—Ä–æ—Å—Ç–Ω–∞—è –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å"

–≠—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª.

- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
    - **–ú—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ –æ–¥–Ω–æ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é –ª–µ—Ç—è—Ç —Å—Ä–∞–∑—É 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–∫–∞—Ä—Ç–∏–Ω–∫–∏, —Å—Ç–∏–ª–∏, JSON).
    - **–°–∂–∞—Ç–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (HPACK):** –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–∂–∏–º–∞—é—Ç—Å—è, —Ç—Ä–∞—Ñ–∏–∫ –º–µ–Ω—å—à–µ.
- **–ö—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:** –ë—Ä–∞—É–∑–µ—Ä—ã. –ò –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `httpx` (–µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å —Ñ–ª–∞–≥).
- **–ó–∞—á–µ–º –ø–∞—Ä—Å–µ—Ä—É:**
    1. **–°–∫–æ—Ä–æ—Å—Ç—å:** –†–µ–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –º–µ–ª–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
    2. **–ú–∏–º–∏–∫—Ä–∏—è (–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ):** –í–∫–ª—é—á–µ–Ω–∏–µ HTTP/2 –¥–µ–ª–∞–µ—Ç —Ç–≤–æ–π —Å–∫—Ä–∏–ø—Ç –ø–æ—Ö–æ–∂–∏–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä. Cloudflare –º–µ–Ω—å—à–µ –∞–≥—Ä–∏—Ç—Å—è.
- *–ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å:*
    
    ```python
    import httpx
    
    client = httpx.Client(http2=True)  # <--- –í–û–¢ –≠–¢–ê –ú–ê–ì–ò–Ø
    resp = client.get("<https://cloudflare-protected.com>")
    
    ```
    

### 3. WebSockets (WS/WSS) ‚Äî "–ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä"

–≠—Ç–æ –≤–æ–æ–±—â–µ –¥—Ä—É–≥–∞—è –∏—Å—Ç–æ—Ä–∏—è. –≠—Ç–æ –Ω–µ "–∑–∞–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç", —ç—Ç–æ "—Ç—Ä—É–±–∞".

- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –¢—ã –æ–¥–∏–Ω —Ä–∞–∑ —Å–æ–µ–¥–∏–Ω—è–µ—à—å—Å—è (`Handshake`), –∏ –∫–∞–Ω–∞–ª –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º. –°–µ—Ä–≤–µ—Ä —Å–∞–º –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ç–µ–±–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø—É—à–∏), –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç. –¢–µ–±–µ –Ω–µ –Ω–∞–¥–æ –¥–æ–ª–±–∏—Ç—å –µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞–º–∏ "–ù—É —á—Ç–æ, —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å?".
- **–ì–¥–µ –∂–∏–≤–µ—Ç:**
    - –ë–∏—Ä–∂–∏ (Binance, MOEX) ‚Äî –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –ª–µ—Ç—è—Ç –≤ —Ä–µ–∞–ª—Ç–∞–π–º–µ.
    - –ë—É–∫–º–µ–∫–µ—Ä—ã ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –º–µ–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.
    - –ß–∞—Ç—ã ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è.
- **–ö–∞–∫ –ø–∞—Ä—Å–∏—Ç—å:** –û–±—ã—á–Ω—ã–π `httpx.get` —Ç—É—Ç **–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç**. –¢–µ–±–µ –Ω—É–∂–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `websockets` –∏–ª–∏ `aiohttp` –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª `while True`, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç —Ç—Ä—É–±—É.
- *–ü—Ä–∏–º–µ—Ä:*
    
    ```python
    import asyncio
    import websockets
    
    async def listen():
        url = "wss://stream.binance.com:9443/ws/btcusdt@trade"
        async with websockets.connect(url) as ws:
            while True:
                msg = await ws.recv()
                print(f"–ü—Ä–∏–ª–µ—Ç–µ–ª–æ: {msg}")
    
    asyncio.run(listen())
    
    ```
    

---

### üïµÔ∏è‚Äç‚ôÇÔ∏è –†–µ–∑—é–º–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞: –ö–∞–∫ –Ω–µ —Å–ø–∞–ª–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ?

1. **–ó–∞–±—É–¥—å –ø—Ä–æ `requests` –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö.**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `requests` (HTTP/1.1) —Å User-Agent –æ—Ç Chrome ‚Äî —ç—Ç–æ –≤—ã—Å—Ç—Ä–µ–ª —Å–µ–±–µ –≤ –Ω–æ–≥—É. –≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ —Ç—É–ø—ã—Ö –±–∞–Ω–æ–≤.
2. **–Æ–∑–∞–π `httpx` —Å `http2=True`.**
–≠—Ç–æ –¥–µ—à–µ–≤—ã–π —Å–ø–æ—Å–æ–± –ø–æ–≤—ã—Å–∏—Ç—å "—Ç—Ä–∞—Å—Ç" (–¥–æ–≤–µ—Ä–∏–µ) –∫ —Ç–≤–æ–µ–º—É —Å–∫—Ä–∏–ø—Ç—É.
3. **–í–∏–¥–∏—à—å "Live" –¥–∞–Ω–Ω—ã–µ? –ò—â–∏ WebSockets.**
–ï—Å–ª–∏ —Ü–∏—Ñ—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ –±–µ–≥—É—Ç, –∞ –≤ `Network -> Fetch/XHR` —Ç–∏—à–∏–Ω–∞ ‚Äî –∏–¥–∏ –≤–æ –≤–∫–ª–∞–¥–∫—É `WS`. –¢–∞–º –ª—å–µ—Ç—Å—è —á–∏—Å—Ç—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–∂–µ –ø–∞—Ä—Å–∏—Ç—å –Ω–µ –Ω–∞–¥–æ, –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–π JSON.

**–ë–ª–æ–∫ 1 (–¢–µ–æ—Ä–∏—è –∂–µ—Ä—Ç–≤—ã) –∑–∞–∫—Ä—ã—Ç.**
–ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏ –¢–∏–ø—ã —Å–∞–π—Ç–æ–≤, –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã.
–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ "–ö—É–¥–∞ –º—ã –ª–µ–∑–µ–º".