# –¢–µ–º–∞ 12: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–∞: –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ (Producer/Consumer), —á—Ç–æ–±—ã –ø–∞—Ä—Å–∏—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –Ω–µ —Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–±–æ–µ?

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–æ–≤–∏—á–∫–æ–≤ –ø–∏—à–µ—Ç –ø–∞—Ä—Å–µ—Ä—ã —Ç–∞–∫:

```python
# –ü–£–¢–¨ –°–ú–ï–†–¢–ù–ò–ö–ê
urls = [...] # –°–ø–∏—Å–æ–∫ –Ω–∞ –º–∏–ª–ª–∏–æ–Ω —Å—Å—ã–ª–æ–∫ –≤ –ø–∞–º—è—Ç–∏
results = []

for url in urls:
    html = get(url)   # –ñ–¥–µ–º —Å–µ—Ç—å
    data = parse(html) # –ñ–¥–µ–º –ø—Ä–æ—Ü
    results.append(data) # –ñ–¥–µ–º –ø–æ–∫–∞ –ø–∞–º—è—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è

save(results) # –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —É–ø–∞–¥–µ—Ç –Ω–∞ 999 999 —Å—Ç—Ä–æ–∫–µ ‚Äî —Ç—ã –ø–æ—Ç–µ—Ä—è–ª –≤—Å—ë.

```

–≠—Ç–æ **–ª–∏–Ω–µ–π–Ω–∞—è –±–ª–æ–∫–∏—Ä—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**.

1. **–ü–∞–º—è—Ç—å:** –°–ø–∏—Å–æ–∫ `urls` –∂—Ä–µ—Ç RAM. –°–ø–∏—Å–æ–∫ `results` –∂—Ä–µ—Ç RAM.
2. **–°–∫–æ—Ä–æ—Å—Ç—å:** –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç, –ø–æ–∫–∞ –∫–∞—á–∞–µ—Ç —Å–µ—Ç—å. –°–µ—Ç—å –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç, –ø–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä.
3. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** –ù–æ–ª—å. –û—à–∏–±–∫–∞ = –∫—Ä–∞—à = –ø–æ—Ç–µ—Ä—è –≤—Å–µ–≥–æ.

---

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ö–æ–Ω–≤–µ–π–µ—Ä (Producer / Consumer)

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∑–∞–≤–æ–¥.

- **Producer (–ü–æ—Å—Ç–∞–≤—â–∏–∫):** –ß—É–≤–∞–∫, –∫–æ—Ç–æ—Ä—ã–π –∫–∏–¥–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –Ω–∞ –ª–µ–Ω—Ç—É –∫–æ–Ω–≤–µ–π–µ—Ä–∞. –û–Ω –±—ã—Å—Ç—Ä—ã–π (–ø—Ä–æ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏).
- **Queue (–û—á–µ—Ä–µ–¥—å):** –°–∞–º–∞ –ª–µ–Ω—Ç–∞ –∫–æ–Ω–≤–µ–π–µ—Ä–∞. –ë—É—Ñ–µ—Ä, –≥–¥–µ –ª–µ–∂–∞—Ç –∑–∞–¥–∞—á–∏.
- **Consumers (–í–æ—Ä–∫–µ—Ä—ã/–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏):** 50 –∫–∏—Ç–∞–π—Ü–µ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö–≤–∞—Ç–∞—é—Ç –¥–µ—Ç–∞–ª–∏ —Å –ª–µ–Ω—Ç—ã –∏ —Å–æ–±–∏—Ä–∞—é—Ç –ê–π—Ñ–æ–Ω—ã. –ï—Å–ª–∏ –æ–¥–∏–Ω –∫–∏—Ç–∞–µ—Ü –∑–∞–±–æ–ª–µ–ª (–æ—à–∏–±–∫–∞), –æ—Å—Ç–∞–ª—å–Ω—ã–µ 49 —Ä–∞–±–æ—Ç–∞—é—Ç.

**–í —á–µ–º –∫–∞–π—Ñ:**

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –ú—ã –∑–∞–ø—É—Å–∫–∞–µ–º 1 –ø—Ä–æ–¥—é—Å–µ—Ä–∞ –∏ 50 –≤–æ—Ä–∫–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
2. **Backpressure (–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–≤–ª–µ–Ω–∏—è):** –û—á–µ—Ä–µ–¥—å –Ω–µ –¥–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä–∞–º –∑–∞—Ö–ª–µ–±–Ω—É—Ç—å—Å—è. –û–Ω–∏ –±–µ—Ä—É—Ç —Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –º–æ–≥—É—Ç –ø–µ—Ä–µ–≤–∞—Ä–∏—Ç—å.
3. **–ò–∑–æ–ª—è—Ü–∏—è:** –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã.

---

### 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ `asyncio` (–ó–æ–ª–æ—Ç–æ–π –°—Ç–∞–Ω–¥–∞—Ä—Ç)

–í Python –µ—Å—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `asyncio.Queue`. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

–í–æ—Ç —à–∞–±–ª–æ–Ω –±–æ–µ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞:

```python
import asyncio
import httpx
from random import randint

# –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (—Å—Å—ã–ª–æ–∫)
queue = asyncio.Queue()

# --- 1. PRODUCER (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Å—ã–ª–æ–∫) ---
async def producer():
    print("üë®‚Äçüè≠ –ü—Ä–æ–¥—é—Å–µ—Ä: –ù–∞—á–∏–Ω–∞—é –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏...")
    for i in range(100):
        # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —á—Ç–µ–Ω–∏–µ –∏–∑ –ë–î, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID, –ø–∞–≥–∏–Ω–∞—Ü–∏—è
        url = f"<https://api.site.com/items/{i}>"
        await queue.put(url) # –ö–ª–∞–¥–µ–º –≤ –æ—á–µ—Ä–µ–¥—å

    print("üë®‚Äçüè≠ –ü—Ä–æ–¥—é—Å–µ—Ä: –í—Å–µ —Å—Å—ã–ª–∫–∏ –≤ –æ—á–µ—Ä–µ–¥–∏.")

# --- 2. CONSUMER (–í–æ—Ä–∫–µ—Ä) ---
async def worker(worker_id: int):
    print(f"ü§ñ –í–æ—Ä–∫–µ—Ä {worker_id}: –ì–æ—Ç–æ–≤ –∫ —Ç—Ä—É–¥—É")

    async with httpx.AsyncClient() as client:
        while True:
            # –ë–µ—Ä–µ–º –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏.
            # –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ - –≤–æ—Ä–∫–µ—Ä —Å–ø–∏—Ç –∏ –∂–¥–µ—Ç.
            url = await queue.get()

            try:
                # --- –¢–£–¢ –í–°–Ø –†–ê–ë–û–¢–ê ---
                # print(f"ü§ñ –í–æ—Ä–∫–µ—Ä {worker_id} –∫–∞—á–∞–µ—Ç {url}")
                await asyncio.sleep(randint(1, 3)) # –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
                # data = parse(response)
                # save_to_db(data) # –ü–∏—à–µ–º —Å—Ä–∞–∑—É! –ù–µ –∫–æ–ø–∏–º –≤ –ø–∞–º—è—Ç–∏!
                # -----------------------
            except Exception as e:
                print(f"üî• –û—à–∏–±–∫–∞ –Ω–∞ {url}: {e}")
                # –í–∞–∂–Ω–æ: –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å url –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥ –æ—à–∏–±–æ–∫
            finally:
                # –°–æ–æ–±—â–∞–µ–º –æ—á–µ—Ä–µ–¥–∏, —á—Ç–æ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
                queue.task_done()

# --- 3. ORCHESTRATOR (–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è) ---
async def main():
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–¥—é—Å–µ—Ä–∞ (–æ–Ω –Ω–∞–ø–æ–ª–Ω–∏—Ç –æ—á–µ—Ä–µ–¥—å)
    prod_task = asyncio.create_task(producer())

    # –ó–∞–ø—É—Å–∫–∞–µ–º 5 –≤–æ—Ä–∫–µ—Ä–æ–≤ (–æ–Ω–∏ –Ω–∞—á–Ω—É—Ç —Ä–∞–∑–≥—Ä–µ–±–∞—Ç—å –æ—á–µ—Ä–µ–¥—å)
    workers = [asyncio.create_task(worker(i)) for i in range(5)]

    # –ñ–¥–µ–º, –ø–æ–∫–∞ –ø—Ä–æ–¥—é—Å–µ—Ä –∑–∞–∫–æ–Ω—á–∏—Ç –Ω–∞–∫–∏–¥—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
    await prod_task

    # –ñ–¥–µ–º, –ø–æ–∫–∞ –æ—á–µ—Ä–µ–¥—å –æ–ø—É—Å—Ç–µ–µ—Ç (–≤–æ—Ä–∫–µ—Ä—ã –≤—Å—ë –¥–æ–¥–µ–ª–∞—é—Ç)
    print("‚è≥ –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏...")
    await queue.join()

    # –û—Ç–º–µ–Ω—è–µ–º –≤–æ—Ä–∫–µ—Ä–æ–≤ (–æ–Ω–∏ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ while True)
    for w in workers:
        w.cancel()

    print("‚úÖ –†–∞–±–æ—Ç–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!")

if __name__ == "__main__":
    asyncio.run(main())

```

### 3. –ü–æ—á–µ–º—É —ç—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –°–µ–Ω—å–æ—Ä–∞?

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –ª–µ—Ç—É:** –í–Ω—É—Ç—Ä–∏ `worker` –º—ã –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (`save_to_db` –∏–ª–∏ –∑–∞–ø–∏—Å—å –≤ CSV) **–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω–æ**.
    - *–†–µ–∑—É–ª—å—Ç–∞—Ç:* –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–∞—Ç —Å–≤–µ—Ç –Ω–∞ 500-–π —Å—Å—ã–ª–∫–µ, —É —Ç–µ–±—è –≤ –±–∞–∑–µ –±—É–¥–µ—Ç –ª–µ–∂–∞—Ç—å 499 —Ç–æ–≤–∞—Ä–æ–≤. –¢—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—à—å.
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –•–æ—á–µ—à—å –±—ã—Å—Ç—Ä–µ–µ? –ü–æ–º–µ–Ω—è–π `range(5)` –Ω–∞ `range(50)`. –ö–æ–¥ –º–µ–Ω—è—Ç—å –Ω–µ –Ω–∞–¥–æ.
3. **Graceful Shutdown:** `queue.join()` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ –≤—ã–π–¥–µ—Ç, –ø–æ–∫–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Å—ã–ª–∫–∞ –Ω–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞.

---

### ‚ö†Ô∏è Level Up: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å (Celery / RabbitMQ)

–ï—Å–ª–∏ `asyncio.Queue` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø–∞–º—è—Ç–∏ –æ–¥–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞. –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —É–ø–∞–¥–µ—Ç ‚Äî –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ–ø–∞–¥–µ—Ç.
–î–ª—è **–æ—á–µ–Ω—å** –±–æ–ª—å—à–∏—Ö —Å–∏—Å—Ç–µ–º (–º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü, —Ä–∞–∑–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã) –≤–º–µ—Å—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—á–µ—Ä–µ–¥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤–Ω–µ—à–Ω–∏–µ –±—Ä–æ–∫–µ—Ä—ã: **RabbitMQ**, **Redis**, **Kafka**.
–ù–æ –¥–ª—è 99% –∑–∞–¥–∞—á (–¥–æ 10 –º–ª–Ω —Å—Ç—Ä–∞–Ω–∏—Ü) `asyncio.Queue` + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

**–†–µ–∑—é–º–µ:**
–ù–∏–∫–∞–∫–∏—Ö —Å–ø–∏—Å–∫–æ–≤ `results = []`.
–ï—Å—Ç—å –û—á–µ—Ä–µ–¥—å. –ï—Å—Ç—å –í–æ—Ä–∫–µ—Ä—ã. –í–æ—Ä–∫–µ—Ä –≤–∑—è–ª -> –°–¥–µ–ª–∞–ª -> –°–æ—Ö—Ä–∞–Ω–∏–ª -> –ó–∞–±—ã–ª.
–¢–æ–ª—å–∫–æ —Ç–∞–∫.

**–ë–ª–æ–∫ 4 (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞) –∑–∞–∫—Ä—ã—Ç.**
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–º—É –±–ª–æ–∫—É ‚Äî **–ë–ª–æ–∫ 5: –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –î–æ—Å—Ç—É–ø**.